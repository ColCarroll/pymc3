import pymc3 as pm
import numpy as np
from numpy.testing import assert_array_almost_equal
from . import helpers


class TestExactSame(helpers.SeededTest):
    def test_hmc(self):
        hmc_trace = np.array([0.00243293,  0.00600789,  0.00472102,  0.00541819,  0.00472709,
                              0.00845161,  0.00930949,  0.00805731,  0.01086154,  0.00822108,
                              0.00513311,  0.00654212,  0.00909556,  0.01175473,  0.01047366,
                              0.00709657,  0.01068576,  0.00932191,  0.01084141,  0.01075428,
                              0.0099735 ,  0.0100123 ,  0.01298014,  0.01338937,  0.01251545,
                              0.01539036,  0.01373173,  0.01456458,  0.01249648,  0.01402685,
                              0.01916435,  0.02029963,  0.02147554,  0.02231398,  0.02349852,
                              0.01992677,  0.01919019,  0.01777814,  0.01354528,  0.01355255,
                              0.01650595,  0.01684626,  0.01958875,  0.01886961,  0.02159433,
                              0.02300997,  0.02268867,  0.02119697,  0.02049096,  0.01913878,
                              0.02021384,  0.01864043,  0.02360907,  0.02288204,  0.02206188,
                              0.02636584,  0.02644119,  0.02743   ,  0.02810058,  0.02654434,
                              0.0253134 ,  0.02590454,  0.02988562,  0.02776083,  0.02667424,
                              0.02458612,  0.02412546,  0.0248423 ,  0.02312255,  0.02059575,
                              0.02072477,  0.02084369,  0.01984252,  0.02164008,  0.02178611,
                              0.02363942,  0.02500326,  0.02326068,  0.01990367,  0.01886165,
                              0.02016719,  0.01904552,  0.02158356,  0.02086266,  0.02407393,
                              0.02394514,  0.0275097 ,  0.02707365,  0.02507232,  0.02638377,
                              0.02502123,  0.02476986,  0.02211184,  0.02481476,  0.02514288,
                              0.02289742,  0.02403804,  0.02350133,  0.02179165,  0.02048839])
        with pm.Model():
            pm.Normal('x', mu=0, sd=1)
            trace = pm.sample(100, step=pm.HamiltonianMC())
        assert_array_almost_equal(trace.get_values('x'), hmc_trace)

    def test_nuts(self):
        nuts_trace = np.array([-0.07750131, -0.3456157 , -0.48229679,  0.48398619, -0.17893599,
                                0.63533607,  0.76948016,  0.76948016,  0.09168565, -0.66862804,
                                1.07730383,  1.33622285,  1.33622285,  0.65169787,  0.56819708,
                                0.76765749, -0.07591901, -0.07591901, -0.06538634,  0.07767834,
                               -0.75321554, -0.75321554, -0.05348701, -0.05348701, -0.59342243,
                               -0.59749507, -0.63878871, -0.63878871, -1.40943894,  0.33317639,
                                1.01969965, -0.51058761,  2.25566479,  2.46909602,  2.46249485,
                                2.3150649 , -1.93692964, -1.93692964, -1.27451705, -1.24824168,
                                0.50900315,  0.51172194,  0.51172194, -0.19644656, -0.19861196,
                                0.22309475, -0.07938213, -0.07938213, -0.07637822,  0.06841433,
                                0.06841433,  0.31442123,  0.80060348,  0.64240086,  0.64240086,
                                0.65067916,  0.54113584,  0.4447451 ,  0.72582555,  0.72582555,
                                0.88640499,  0.96590719,  2.11641357,  1.79688418,  1.79688418,
                                1.93145066,  1.95204198,  1.97759203,  1.68017845,  1.68017845,
                                1.70559164,  1.68986129,  1.66877992, -0.63252061, -0.63252061,
                               -0.73631041, -0.95359123, -0.95359123, -0.96108195, -1.49377404,
                                1.05830631,  1.05830631, -0.18119414,  0.16408021,  0.6667455 ,
                               -0.59115674, -0.59115674, -0.59036545, -0.78192683, -0.82333697,
                               -1.11024324, -1.11024324, -0.93465118,  0.07681018,  0.28763638,
                               -0.17922376, -0.05272613, -0.05272613, -0.50468172, -0.21871034])
        with pm.Model():
            pm.Normal('x', mu=0, sd=1)
            trace = pm.sample(100, step=pm.NUTS())
        assert_array_almost_equal(trace.get_values('x'), nuts_trace)
